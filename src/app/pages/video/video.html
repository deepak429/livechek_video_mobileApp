<ion-content>

  <!-- Initial UI -->
  <div *ngIf="uiState === 'initial'" class="state-container initial-container">
    <img class="placeholder-image" 
         src="https://godreamcast.com/blog/wp-content/uploads/2024/02/What-is-Cloud-Video-Streaming-1024x694.jpg" />
    <div class="start-button-wrapper">
      <p class="info-text">{{ instructionText }}</p>
      <ion-button expand="block" (click)="findAgent()">
        <ion-icon name="search-outline" slot="start"></ion-icon>
        Find Agents
      </ion-button>
    </div>
  </div>
  
  <div *ngIf="uiState === 'searching'" class="state-container searching-container">
    <div class="timer-container" style="margin-top: 20vh;">
      <svg class="timer-svg" viewBox="0 0 100 100">
        <circle class="timer-background" cx="50" cy="50" r="45"></circle>
        <circle class="timer-progress" cx="50" cy="50" r="45"
                [style.stroke-dashoffset]="calculateStrokeOffset()"></circle>
      </svg>
      
      
      <div class="timer-text">

        <div class="timer-countdown">{{ displayTime }}</div>
        <div class="timer-status">Searching<span>.</span><span>.</span><span>.</span></div>
      </div>
    </div>
  </div>

  
  <!-- Web recording UI -->
  <div *ngIf="uiState === 'recording'" class="video-container web-recording" >
    <!-- Main video for the agent's stream -->
    <video #remoteVideo id="remoteVideo" autoplay playsinline muted></video>
<!-- webVideo -->
 
    <!-- Local video preview (picture-in-picture) -->
    <video #webVideo id="webVideo" autoplay playsinline></video>
<!-- remoteVideo -->
    <!-- Overlay for controls -->
    <div class="controls-overlay">
      <div class="recording-timer">REC {{ displayRecordingTime }}</div>
      <ion-button color="light" (click)="swapCamera()" *ngIf="canSwapCamera" class="swap-camera-btn">
        <ion-icon name="camera-reverse-outline"></ion-icon>
      </ion-button>
      <ion-button color="danger" (click)="stopWebRecording()">Stop Streaming</ion-button>
    </div>
  </div>

  <!-- Completed UI -->
  <div *ngIf="uiState === 'completed'" class="state-container completed-container">
    <ion-icon name="checkmark-circle-outline" class="completed-icon"></ion-icon>
    <h2>Call Completed</h2>
    <p>{{ instructionText }}</p>
    <ion-button (click)="reconnect()" expand="block">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Start New Session
    </ion-button>
  </div>

  <!-- Failed UI -->
  <div *ngIf="uiState === 'failed'" class="state-container failed-container">
    <ion-icon name="alert-circle-outline" class="failed-icon"></ion-icon>
    <h2>Connection Failed</h2>
    <p>{{ instructionText }}</p>
    <ion-button (click)="reconnect()" expand="block">
      <ion-icon name="refresh-outline" slot="start"></ion-icon>
      Reconnect
    </ion-button>
  </div>
</ion-content>